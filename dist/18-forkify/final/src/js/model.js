import{async}from"regenerator-runtime";import{API_URL,RES_PER_PAGE,KEY}from"./config.js";import{AJAX}from"./helpers.js";const state={recipe:{},search:{query:"",results:[],page:1,resultsPerPage:RES_PER_PAGE},bookmarks:[]},createRecipeObject=function(e){e=e.data.recipe;return{id:e.id,title:e.title,publisher:e.publisher,sourceUrl:e.source_url,image:e.image_url,servings:e.servings,cookingTime:e.cooking_time,ingredients:e.ingredients,...e.key&&{key:e.key}}},loadRecipe=async function(t){try{var e=await AJAX(""+API_URL+t+"?key="+KEY);state.recipe=createRecipeObject(e),state.bookmarks.some(e=>e.id===t)?state.recipe.bookmarked=!0:state.recipe.bookmarked=!1,console.log(state.recipe)}catch(e){throw console.error(e+" ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥"),e}},loadSearchResults=async function(e){try{state.search.query=e;var t=await AJAX(API_URL+`?search=${e}&key=`+KEY);console.log(t),state.search.results=t.data.recipes.map(e=>({id:e.id,title:e.title,publisher:e.publisher,image:e.image_url,...e.key&&{key:e.key}})),state.search.page=1}catch(e){throw console.error(e+" ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥"),e}},getSearchResultsPage=function(e=state.search.page){var t=((state.search.page=e)-1)*state.search.resultsPerPage,e=e*state.search.resultsPerPage;return state.search.results.slice(t,e)},updateServings=function(t){state.recipe.ingredients.forEach(e=>{e.quantity=e.quantity*t/state.recipe.servings}),state.recipe.servings=t},persistBookmarks=function(){localStorage.setItem("bookmarks",JSON.stringify(state.bookmarks))},addBookmark=function(e){state.bookmarks.push(e),e.id===state.recipe.id&&(state.recipe.bookmarked=!0),persistBookmarks()},deleteBookmark=function(t){var e=state.bookmarks.findIndex(e=>e.id===t);state.bookmarks.splice(e,1),t===state.recipe.id&&(state.recipe.bookmarked=!1),persistBookmarks()},init=function(){var e=localStorage.getItem("bookmarks");e&&(state.bookmarks=JSON.parse(e))},clearBookmarks=(init(),function(){localStorage.clear("bookmarks")}),uploadRecipe=async function(e){try{var t=Object.entries(e).filter(e=>e[0].startsWith("ingredient")&&""!==e[1]).map(e=>{e=e[1].split(",").map(e=>e.trim());if(3!==e.length)throw new Error("Wrong ingredient fromat! Please use the correct format :)");var[e,t,r]=e;return{quantity:e?+e:null,unit:t,description:r}}),r={title:e.title,source_url:e.sourceUrl,image_url:e.image,publisher:e.publisher,cooking_time:+e.cookingTime,servings:+e.servings,ingredients:t},a=await AJAX(API_URL+"?key="+KEY,r);state.recipe=createRecipeObject(a),addBookmark(state.recipe)}catch(e){throw e}};export{state,loadRecipe,loadSearchResults,getSearchResultsPage,updateServings,addBookmark,deleteBookmark,uploadRecipe};